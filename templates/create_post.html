{% extends 'base.html' %}

{% block content %}
<style>
	.highlight {
		border: 2px solid black;
	}
</style>
<div class="drop-area" style="width: 500px; height: 500px; margin: auto; background-color: tomato;"></div>
<script>
	let drop_area = document.querySelector('.drop-area')
	console.log(drop_area)
	drop_area.addEventListener('dragenter', handlerFunction, false)
	drop_area.addEventListener('dragleave', handlerFunction, false)
	drop_area.addEventListener('dragover', handlerFunction, false)
	drop_area.addEventListener('drop', handlerFunction, false)	

	drop_area.addEventListener('drop', handle_drop, false)

	function handlerFunction(e) {
		e.preventDefault()
		e.stopPropagation()
	}

	function handle_drop(e) {
		let dt = e.dataTransfer;
		console.log(dt)
		handle_files(dt);
	} 

	function handle_files(dt) {
		([...dt.files]).forEach(upload_files);
	}

	async function upload_files(file) {
		console.log(file)
		const url = '/upload_image';
		let form_data = new FormData();
		form_data.append('file', file);
		form_data.append('image_name', file.name)

		let response = await fetch(url, {
			method: 'POST',
			body: form_data
		})
		console.log(response)
		if (response.ok) {
			let text = await response.text()
			console.log(text)
		} else {
			console.log('Error is:', reponse.status)
		}
	}


	['dragenter', 'dragover'].forEach(eventName => {
	  drop_area.addEventListener(eventName, highlight, false)
	});
	['dragleave', 'drop'].forEach(eventName => {
	  drop_area.addEventListener(eventName, unhighlight, false)
	});

	function highlight(e) {
	  drop_area.classList.add('highlight')
	}
	function unhighlight(e) {
	  drop_area.classList.remove('highlight')
	}
</script>

{% endblock %}